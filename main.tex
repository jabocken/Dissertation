%        File: VTthesis_template.tex
%     Created: Thu Mar 24 11:00 AM 2016 EDT
%     Last Change: Mon, April 30, 2018
%      Author: Alan M. Lattimer, VT
%	   With modifications by Carrie Cross, Robert Browder, and LianTze Lim.
%
% This template is designed to operate with XeLaTeX.
%
% All elements in the Title, Abstract, and Keywords MUST be formatted as text and NOT as math.

\documentclass[prelim,pageskip]{VTthesis}

\usepackage{suffix}                % For defining command versions with *s

\usepackage{microtype} % Not everything is supported when using XeLaTeX, but should help a bit in making text look nicer.
\usepackage{textcomp}  % Fixes issue with microtype+siunitx's \micro

\usepackage[en-US]{datetime2}      % For \DTMdate, etc.
\usepackage[binary-units]{siunitx}
\usepackage{mathtools}             % for \coloneqq
\usepackage{bussproofs}            % for prooftree environment
\usepackage[epsilon]{backnaur}     % For BNF diagrams; a (more complex?) alternative is the syntax package

\usepackage{booktabs}              % For nicer-looking tables
\usepackage{makecell}              % For table heading cells and cells with line breaks
\usepackage{threeparttable}        % For tables with notes
\usepackage[inline]{enumitem}

\usepackage[index,single]{acro}                  % For acronyms; hyperref option changes acro colors but doesn't actually link to the list so not using it right now

\usepackage{pgfplots}               % For plots

\usetikzlibrary{external}          % To reduce build times for complex figures (does one-time builds and stores as images)
\usetikzlibrary{graphs}            % dot-style graph shorthands (not quite as compactible as dot language, though)
\usetikzlibrary{quotes}            % needed for quoted edge labels (only in graphs?)
\usetikzlibrary{positioning}       % For relative (=of) node positioning

\pgfplotsset{compat=1.15}          % For up-to-date features
%\tikzexternalize[prefix=extern/]                  % Enables externalization (has issues with figures containing references when used with XeLaTeX, so turn off externalization when you need those)

\DeclareAcronym{abi}{
  short            = ABI,
  short-indefinite = an,
  long             = application binary interface,
  long-indefinite  = an
}
\DeclareAcronym{aec2}{short=Amazon EC2, long=Amazon Elastic Compute Cloud}
\DeclareAcronym{afp}{short=AFP, long=Archive of Formal Proofs}
\DeclareAcronym{cfg}{short=CFG, long=control flow graph}
\DeclareAcronym{cfi}{short=CFI, long=control-flow integrity}
\DeclareAcronym{dm}{short=DM, long=device model}
\DeclareAcronym{fmuc}{
  short            = FMUC,
  short-indefinite = an,
  long             = formal memory usage certificate
}
\DeclareAcronym{hvm}{
  short            = HVM,
  short-indefinite = an,
  long             = hardware virtual machine
}
\DeclareAcronym{gcc}{short=GCC, long=the GNU Compiler Collection}
\DeclareAcronym{icc}{
  short            = ICC,
  short-indefinite = an,
  long             = the Intel C++ Compiler
}
\DeclareAcronym{ipc}{
  short            = IPC,
  short-indefinite = an,
  long             = inter-process communication,
  long-indefinite  = an
}
\DeclareAcronym{isa}{
  short            = ISA,
  short-indefinite = an,
  long             = instruction set architecture,
  long-indefinite  = an
}
\DeclareAcronym{isar}{
  short            = Isar,
  short-indefinite = an,
  long             = intelligible semi-automated reasoning
}
\DeclareAcronym{itp}{
  short            = ITP,
  short-indefinite = an,
  long             = interactive theorem proving,
  long-indefinite  = an
}
\DeclareAcronym{mrr}{short=MRR, long=memory region relation}
\DeclareAcronym{os}{
  short            = OS,
  short-indefinite = an,
  long             = operating system,
  long-indefinite  = an,
  short-plural     = es
}
\DeclareAcronym{rop}{
  short            = ROP,
  short-indefinite = an,
  long             = return-oriented programming
}
\DeclareAcronym{qemu}{short=QEMU, long=Quick Emulator}
\DeclareAcronym{scc}{
  short            = SCC,
  short-indefinite = an,
  long             = strongly connected component
}
\DeclareAcronym{scf}{
  short            = SCF,
  short-indefinite = an,
  long             = syntactic control flow
}
\DeclareAcronym{simd}{short=SIMD, long=single instruction multiple data}
\DeclareAcronym{sloc}{short=SLOC, long=source lines of code}
\DeclareAcronym{smt}{
  short            = SMT,
  short-indefinite = an,
  long             = satisfiability modulo theories
}
\DeclareAcronym{sse}{
  short            = SSE,
  short-indefinite = an,
  long             = Streaming SIMD Extensions,
  long-indefinite  = an,
}
\DeclareAcronym{tcb}{short=TCB, long=trusted computing base}
\DeclareAcronym{vcg}{short=VCG, long=verification condition generator}
\DeclareAcronym{vm}{short=VM, long=virtual machine}
\DeclareAcronym{vmm}{short=VMM, long=virtual machine monitor}

\lstdefinelanguage
  [x64]{Assembler}     % add an "x64" dialect of Assembler
  [x86masm]{Assembler} % based on the "x86masm" dialect
  % with these extra keywords:
  {morekeywords={CDQE,CQO,CMPSQ,CMPXCHG16B,JRCXZ,LODSQ,MOVSXD,% will add more insts as needed
      POPFQ,PUSHFQ,SCASQ,STOSQ,IRETQ,RDTSCP,SWAPGS,%
      MOVAPD,MOVDQA,
      dil,%
      rax,rdx,rcx,rbx,rsi,rdi,rsp,rbp,rip,%
      r8,r8d,r8w,r8b,r9,r9d,r9w,r9b,%
      r10,r10d,r10w,r10b,r11,r11d,r11w,r11b,%
      r12,r12d,r12w,r12b,r13,r13d,r13w,r13b,%
      r14,r14d,r14w,r14b,r15,r15d,r15w,r15b}} % etc.
\lstdefinestyle{x64}{
  language=[x64]{Assembler},
  keywordstyle=\bfseries\color{blue}, % bold blue keywords
  commentstyle=\color{gray},
  identifierstyle=\color{purple},
  stringstyle=\color{brown},
}

\newcommand{\xenpercentage}{\SI{71}{\percent}}
\newcommand{\xenpercentagenot}{\SI{29}{\percent}}

\newcommand{\inlineasm}[1]{\lstinline[style=x64]|#1|}

%% Math commands
\newcommand{\letin}[2]{\textbf{let} \(#1\) \textbf{such that} \(#2\)}
\newcommand{\ind}[1]{\hspace{#1}}
\newcommand*{\eqsetfix}{\mathrel{\phantom{=}}\phantom{\{}}
\newcommand*{\equivsetfix}{\mathrel{\phantom{\equiv}}\phantom{\{}}

\newcommand{\asp}{A_\mathrm{SP}}
\newcommand{\esp}{E_\mathrm{SP}}
\newcommand{\bop}{\mathbin{\bigcirc}}

\newcommand{\true}{\mathrm{T}}
\newcommand{\false}{\mathrm{F}}
\DeclareMathOperator{\powerset}{\mathcal{P}}

\DeclareMathOperator{\unat}{unat}

\newcommand{\concat}{\bullet}
\newcommand{\mmerge}{\text{ merge }}
\newcommand{\var}[1]{\mathit{#1}}
\DeclareMathOperator{\step}{step}
\DeclareMathOperator{\run}{run\_until}
\DeclareMathOperator{\loc}{loc}
\DeclareMathOperator{\rbxpops}{multiplicands\_pushed}
\DeclareMathOperator{\retsites}{ret\_addrs\_pushed}

\DeclareMathOperator{\blockusage}{block\_usage}
\DeclareMathOperator{\nbo}{no\_block\_overflow}
\DeclareMathOperator{\sextend}{sextend}
\DeclareMathOperator{\usage}{usage}
\DeclareMathOperator{\exec}{exec\_scf}
\DeclareMathOperator{\execblock}{symb\_exec}

\newcommand*{\ASeq}{\mathrel{\texttt{;}}}
\WithSuffix{\newcommand*}\ASeq*{\texttt{;}}
\newcommand*{\AWhile}{\texttt{Loop}}
\newcommand*{\AOd}{\texttt{Pool}}
\newcommand*{\AIf}{\texttt{If}}
\newcommand*{\AThen}{\texttt{Then}}
\newcommand*{\AElse}{\texttt{Else}}
\newcommand*{\AFi}{\texttt{Fi}}
\newcommand*{\ABB}{\texttt{Block}}
\newcommand*{\ASkip}{\texttt{Skip}}
\newcommand*{\ACall}{\texttt{Call}}
\newcommand*{\ABreak}{\texttt{Break}}
\newcommand*{\AContinue}{\texttt{Continue}}
\newcommand*{\AWhileResume}{\texttt{Resume}}

\DeclareMathOperator{\scf}{scf}
\DeclareMathOperator{\pre}{pre}
\DeclareMathOperator{\post}{post}
\DeclareMathOperator{\ID}{ID}
\DeclareMathOperator{\exit}{exit}
\DeclareMathOperator{\sccs}{SCCS}
\DeclareMathOperator{\sem}{sem}
\DeclareMathOperator{\takeuntil}{take\_until}
\DeclareMathOperator{\subst}{subst}

\DeclarePairedDelimiter{\takebits}{\langle}{\rangle}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}

\newcommand{\Block}[2]{\mathtt{#1\texttt{->}#2}}

\newcommand{\region}[2]{\ensuremath{[#1,#2]}}
\newcommand{\readmem}[2]{\ast\region{#1}{#2}}
\newcommand{\readmemS}[3]{#1:\readmem{#2}{#3}}
\newcommand{\htriple}[3]{\{#1\}#2\{#3\}}
\WithSuffix\newcommand\htriple*[4]{\{#1\}#2\{#3{;}#4\}}
\newcommand{\parent}[3]{\operatorname{parent}(#1,#2,#3)}

\newcommand{\deqptr}{\var{deq}_\mathrm{ptr}}
\newcommand{\bufferptr}{\var{buf}_\mathrm{ptr}}
\newcommand{\outptr}{\var{out}_\mathrm{ptr}}
\newcommand{\valueptr}{\var{value}_\mathrm{ptr}}

\newcommand{\mathrax}{\text{\inlineasm{rax}}}
\newcommand{\mathrip}{\text{\inlineasm{rip}}}
\newcommand{\mathrbp}{\text{\inlineasm{rbp}}}
\newcommand{\mathrbx}{\text{\inlineasm{rbx}}}
\newcommand{\mathrdi}{\text{\inlineasm{rdi}}}
\newcommand{\mathrsi}{\text{\inlineasm{rsi}}}
\newcommand{\mathrsp}{\text{\inlineasm{rsp}}}
\newcommand{\mathdil}{\text{\inlineasm{dil}}}
\newcommand{\mathdl}{\text{\inlineasm{dl}}}

\newcommand{\fso}{\var{fs}_0}
\newcommand{\rdio}{\var{rdi}_0}
\newcommand{\rsio}{\var{rsi}_0}
\newcommand{\rspo}{\var{rsp}_0}
\newcommand{\rbpo}{\var{rbp}_0}

\newcommand{\retaddr}{\mathtt{ret\_addr}}

\newcommand{\psep}{P_\mathrm{sep}}

% Misc. commands
\newcommand{\todo}[1]{{\bfseries\color{purple}#1}} % Allowing paragraphs in todos
\newcommand*{\fturl}[1]{\footnote{\url{#1}}}

% Title of your thesis
\title{Title of your thesis goes here}

% You should include 3-5 keywords, separated by commas
\keywords{Some Keywords, Subject matter, etc.}

\author{Joshua Alexander Bockenek}
\program{Electrical and Computer Engineering}
\degree{Doctor of Philosophy}

% This should be your defense date: (update when settled)
\submitdate{\DTMdate{2019-09-02}}

\principaladvisor{Binoy Ravindran}
\firstreader{Freek Verbeek}
\secondreader{Patrick R. Schaumont}
\thirdreader{Michael S. Hsiao}
\fourthreader{Changhee Jung}

% The dedication and acknowledgement pages are optional. Comment them out to remove them.
\dedication{This is where you put your dedications.}
\acknowledge{This is where you put your acknowledgments.}

% The abstract is required and should be <=250 words for thesis, <=350 words for dissertation.
\abstract{%
  Give a brief description of your thesis here. Max of 250 words for a master's thesis and 350 words for a PhD dissertation, according to the VT ETD standards.
}

% The general audience abstract is required. There are currently no word limits.
\abstractgenaud{You are also required as of Spring 2016 to include a general audience abstract. This should be geared towards individuals outside of your field that may be reading seeking information about your work. You should avoid language that is particular to your field and clearly define any terms that may have special meaning in your discipline.}

% Bit of work needed to get stuff not added to the TOC automatically into the TOC
\newcommand{\addtocfix}[2]{
  \clearpage\phantomsection % Getting hyperref to link to the right page
  \addcontentsline{toc}{chapter}{#1}
  #2
}

% Listings properly in TOC
\renewcommand\lstlistlistingname{List of Listings}
\renewcommand{\lstlistoflistings}{\begingroup
  \tocfile\lstlistlistingname{lol}
\endgroup}

\makeindex[intoc]
\begin{document}
  % Sets up the document for the front matter of the dissertation (all the stuff before the body)
  \frontmatter
  \maketitle
  \tableofcontents

  \listoffigures
  \listoftables
  \listofalgorithms
  \lstlistoflistings
  \addtocfix{Acronyms}{\printacronyms[heading=chapter*]}
  \printnomenclature

  \input{attribution} % prefaces go in front matter

  % Sets up the document for the main part of the dissertation.
  \mainmatter

  \input{introduction}
  \input{background}
  \input{related}
  \input{memory_usage}
  \input{symbolic_execution}
  \input{cfg}
  \input{syntax}
  \input{conclusions}

  {% appendices don't work right with backmatter on its own due to the lack of counters
    \backmatter

    \bibliographystyle{plainnat}
    \bibliography{bibliography}

    \printindex
  }
%  \begin{appendices}
%    \renewcommand*\chaptername\appendixname % find a better spot
%  	\chapter{First Appendix} \label{app:appendix_one}
%  		\section{Section one} \label{ase:app_one_sect_1}
%      \clearpage
%  		\section{Section two} \label{ase:app_one_sect_2}
%  	\chapter{Second Appendix} \label{app:appendix_two}
%      \clearpage
%  		\section{Section a}
%  \end{appendices}
\end{document}

%****************************************************************************
% 2.       Citation                     Output
%      -------------------------------------------------------
%      \citep{doe_title_2016}        [18]
%      \citet{doe_title_2016}       Doe et al. [18]
%      \citet*{doe_title_2016}      Doe, Jones, and Smith [18]
%
%    For a complete list of options, see
%      https://www.ctan.org/pkg/natbib?lang=en
%
%----------------------------------------------------------------------------
%
% The following is a list of definitions and packages provided by VTthesis:
%
% A. The following packages are provided by the VTthesis class:
%      amsmath, amsthm, amssymb, enumerate, natbib, hyperref, graphicx,
%      tikz (with shapes and arrows libraries), caption, subcaption,
%      listings, verbatim
%
% B. The following theorem environments are defined by VTthesis:
%      theorem, proposition, lemma, corollary, conjecture
%
% C. The following definition environments are defined by VTthesis:
%      definition, example, remark, algorithm
%
%----------------------------------------------------------------------------
%
%  I hope this template file and the VTthesis class will keep you from having
%  to worry about the formatting and allow you to focus on the actual writing.
%  Good luck, and happy writing.
%    Alan Lattimer, VT, 2016
%
%****************************************************************************
